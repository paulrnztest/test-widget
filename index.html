<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug Widget v1.0.0</title> <!-- Version only in title -->
  <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
</head>
<body>
  <p>Open the console to see logs.</p>

  <script>
    async function waitForAgentSDK(timeout = 5000) {
      const start = Date.now();
      while (!window.lpTag?.agentSDK) {
        if (Date.now() - start > timeout) throw new Error("lpTag.agentSDK did not load in time");
        await new Promise(r => setTimeout(r, 100));
      }
      return window.lpTag.agentSDK;
    }

    async function initAgentSDK() {
      try {
        const agentSDK = await waitForAgentSDK();
        agentSDK.init({});
        console.log("[LP] agentSDK initialized");

        // Log current conversation ID
        function printConversationId(context) {
          if (context?.CONVERSATION?.ID) {
            console.log("Active Conversation ID:", context.CONVERSATION.ID);
          } else {
            console.warn("No active conversation.");
          }
        }

        // Subscribe to conversation changes in real-time
        agentSDK.subscribe('CONVERSATION', (event) => {
          printConversationId(event);
        });

        // Print current conversation immediately if it exists
        printConversationId(agentSDK.getContextData?.());

      } catch (e) {
        console.error("[LP] agentSDK.init failed", e);
      }
    }

    initAgentSDK();
  </script>
</body>
</html>
