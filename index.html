<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug Widget</title>
  <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
</head>
<body>
  <h1>Debug Widget v1.0.2</h1> <!-- Version displayed on the page -->
  <p>Open the console to see logs for the conversation ID.</p>

  <script>
    async function waitForAgentSDK(timeout = 5000) {
      const start = Date.now();
      while (!window.lpTag?.agentSDK) {
        if (Date.now() - start > timeout) throw new Error("lpTag.agentSDK did not load in time");
        await new Promise(r => setTimeout(r, 100));
      }
      return window.lpTag.agentSDK;
    }

    async function initAgentSDK() {
      try {
        const agentSDK = await waitForAgentSDK();
        agentSDK.init({});
        console.log("[LP] agentSDK initialized");

        // Poll for conversation ID every 5 seconds
        setInterval(() => {
          const context = agentSDK.getContextData?.();
          console.log("Full agentSDK context:", agentSDK.getContextData?.());
          if (context?.CONVERSATION?.ID) {
            console.log("Active Conversation ID:", context.CONVERSATION.ID);
          } else {
            console.warn("No active conversation");
          }
        }, 5000);

        // Also print once immediately
        const context = agentSDK.getContextData?.();
        if (context?.CONVERSATION?.ID) {
          console.log("Active Conversation ID:", context.CONVERSATION.ID);
        } else {
          console.warn("No active conversation");
        }

      } catch (e) {
        console.error("[LP] agentSDK.init failed", e);
      }
    }

    initAgentSDK();
  </script>
</body>
</html>

