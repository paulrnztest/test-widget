<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug Widget</title>
  <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
</head>
<body>
  <h1>Debug Widget v1.0.3</h1>
  <p>Open the console to see logs for debugging.</p>

  <script>
    async function waitForAgentSDK(timeout = 5000) {
      const start = Date.now();
      while (!window.lpTag?.agentSDK) {
        if (Date.now() - start > timeout) throw new Error("lpTag.agentSDK did not load in time");
        await new Promise(r => setTimeout(r, 100));
      }
      return window.lpTag.agentSDK;
    }

    async function initAgentSDK() {
      try {
        const agentSDK = await waitForAgentSDK();
        agentSDK.init({});
        console.log("[LP] agentSDK initialized");

        // --- Debugging information ---
        console.log("Full agentSDK object:", agentSDK);
        console.log("lpTag config:", window.lpTag?.config);
        console.log("Window location:", window.location.href);

        // Poll for conversation ID every 5 seconds
        setInterval(() => {
          if (!agentSDK.getContextData) {
            console.warn("[Debug] agentSDK.getContextData is undefined!");
            return;
          }

          const context = agentSDK.getContextData();
          console.log("Full context object:", context);

          if (context?.CONVERSATION?.ID) {
            console.log("Active Conversation ID:", context.CONVERSATION.ID);
          } else {
            console.warn("No active conversation");
          }
        }, 5000);

        // Initial check immediately
        if (agentSDK.getContextData) {
          const context = agentSDK.getContextData();
          console.log("Initial full context:", context);
        } else {
          console.warn("[Debug] agentSDK.getContextData is undefined on init!");
        }

      } catch (e) {
        console.error("[LP] agentSDK.init failed", e);
      }
    }

    initAgentSDK();
  </script>
</body>
</html>
